<%- include ('partials/_header'); -%>

<nav class="navbar navbar-expand-lg navbar-light bg-dark">
  <div class="container-fluid">
    <a class="text-primary navbar-brand" href="#">Monitor Camara</a>

<div class="dropdown">
  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownmenu" data-bs-toggle="dropdown" aria-expanded="false">
iniciar session
</button>
<div class="dropdown-menu" aria-labelledby="dropdownmenu">
<a class="dropdown-item" >iniciar session</a>
<form class="dropdown-item" action="/login" id="form-login" method="POST">
  <div class="form-group">
  <label>Usuario</label>
  <input type="text" id="usuario" name="usuario" class="form-control" placeholder="usuario" >
  </div>
  <div class="form-group">
  <label>Password</label>
  <input id="password" type="password" name="password" class="form-control" placeholder="password">
  </div>
  <div class="form-group">
  <button type="button" id="entrar" value="Ingresar" class="btn btn-secondary">Ingresar</button>
  </div>
</form>
  
</div>
</div>

    
  </div>
</div>
</nav>

 <span class="navbar navbar-dark bg-dark" id="blink"><strong>En Pausa 
 </span>
   <p class="text-center text-muted">Es nesesario iniciar session para ver la transmision en tiempo real...  </p>
  </strong>

 
  <div>
             <img src="<%= url %>" width="830" height="580"  />
  </div>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

<script>

$(document).ready(function() {
  $('#entrar').click(function() {
    const usuario = $("#usuario").val();
    const password = $("#password").val();
    if (usuario.length < 1 || password.length < 1) {
      Swal.fire("Completar todos los campos");
    } else {
      grecaptcha.ready(function() {
        grecaptcha.execute('6LeZaXMhAAAAAIeQV_ILv_8HtCJO5MGOiyD9PxSP', {
          action: 'validarUsuario'
        }).then(function(token) {
          const formLogin = $('#form-login');
          formLogin.prepend(`<input type="hidden" name="token" value="${token}" >`);
          formLogin.prepend(`<input type="hidden" name="action" value="validarUsuario" >`);
          formLogin.submit();
        });
      });
    }
  });
});


</script>

<script type="text/javascript">


  
  window.setInterval (BlinkIt, 500);
var color = "red";
function BlinkIt () {
var blink = document.getElementById ("blink");
color = (color == "#ffffff")? "red" : "#ffffff";
blink.style.color = color;
blink.style.fontSize='18px';}


</script>

  <p class="text-center text-muted">Es nesesario iniciar session para ver los ultimos movimientos</p>
  

  <nav class="text-right navbar navbar-expand-lg navbar-light bg-dark">
  <div class="text-right container-fluid">
  <a class="text-danger navbar-brand">
Acceso Solo Usuarios Authorizados</a>
</div>
</nav>

<nav class="text-right navbar navbar-expand-lg navbar-light bg-dark">
<head>

      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/default.min.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
</head>
<div class="chat-container" id="chat-container" style="background-image: url(https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRcl3iikGkQL5aGQIqXkJJxIw3yZ1F-KOTIqQ&usqp=CAU); background-size: cover;">
  <div class="chat-header">
  <h1>    ChatGPT from Openai</h1>
  </div>
  <div class="chat-messages" id="chat-messages" style="overflow:auto;">
    <div class="message-container" style="border-radius: 30px;">
    <p class="sender" >chat-bot con inteligencia artificial...</p>

    </div>

    <div id="chat-display" style="color: black;">
    </div>
    </div>
    <div class="chat-input">
    <input type="text" id="chat-input" placeholder="Escribe tu mensaje aquí...">
    <button id="send-button" style="color: red;height: 43px;width: 80px;">Enviar</button>
    </div>
</div>
</nav>
          <p class="text-center text-muted">@Copyright-byElverdes</p>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js"></script>

<script>


var dotsInterval = '';
$(document).ready(function() {

  function randomString(possible) {
    var result = '';
    for (var i = 0; i < 5; i++) {
      result += possible.charAt(Math.floor(Math.random() * possible.length));
    }
    return result;
  }

  $('#send-button').click(function() {
    var message = $('#chat-input').val();
    if (!message) {
      return;
    }
    var randomS = randomString("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");
    var randomSS = randomString("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");
/*
    $('#chat-display').append(`
      <div class="message-container" style="border-radius: 20px;background-color: green; padding: 5px;text-align: right;">
        <span class="sender" style="text-align: right;" >Yo:</span>
        ${message}
      </div>
    `);*/
    
    // Obtener el elemento del DOM para el contenedor de mensajes
const chatDisplay = document.getElementById('chat-display');

// Crear un nuevo elemento de mensaje
const messageContainer = document.createElement('div');
messageContainer.classList.add('message-container');
messageContainer.style.borderRadius = '20px';
messageContainer.style.backgroundColor = 'green';
messageContainer.style.padding = '5px';
messageContainer.style.textAlign = 'right';
//messageContainer.style.maxWidth = "500px";
messageContainer.style.wordWrap = "break-word"
// Crear un elemento de texto para el contenido del mensaje
const messageText = document.createElement('span');
messageText.classList.add('sender');
messageText.style.textAlign = 'right';
messageText.textContent = "Yo: " + message;

// Codificar el contenido del mensaje para evitar la inyección de JavaScript
//const encodedMessage = encodeURIComponent(message);

// Establecer el contenido del mensaje usando la codificación de caracteres
//messageText.textContent = encodedMessage;

// Agregar el elemento de texto al contenedor de mensaje
messageContainer.appendChild(messageText);

// Agregar el contenedor de mensaje al elemento del DOM para mostrarlo en la página
chatDisplay.appendChild(messageContainer);



    $('#chat-input').val('');


    var container = $('#chat-messages');
    var height = container[0].scrollHeight;
    container.scrollTop(height);

    setTimeout(function(){
      $('#chat-display').append(`
        <div class="message-container" style="border-radius: 25px;background-color: #dddddd; padding: 5px;color: blue;">
          <span class="sender">ChatGPT:
	  <pre class="code" style="padding: 1px;" >
	  <code id="${randomS}">.
	  </code>
	  </pre>
	  </span>
	  </div>
      `);
      var dots = $(`#${randomS}`);
      dotsInterval = setInterval(function() {
        if(dots.text().length >= 3) {
          dots.text(".");
        } else {
          dots.text(dots.text() + ".");
        }
      }, 500);
      container = $('#chat-messages');
      height = container[0].scrollHeight;
      container.scrollTop(height);
    },1000);

grecaptcha.ready(function() {
    grecaptcha.execute('6LeZaXMhAAAAAIeQV_ILv_8HtCJO5MGOiyD9PxSP', {action: 'submit'}).then(function(token) { //var encodedMessage = encodeURIComponent(he.encode(message));
  var encodedMessage = encodeURIComponent(he.encode(message));
var data = { prompt: encodedMessage, token: token };
var url = '/chat?' + $.param(data)
$.ajax({
  url: url,
  type: 'GET',
  dataType: 'text',
  success: function(response) {

      clearInterval(dotsInterval);
      let responseString;
      if (typeof response === "function") {
      responseString = response.toString();

      } else {
      responseString = response;

      }

      $(`#${randomS}`).text(`
        ${responseString}
      `);

      container = $('#chat-messages');
      height = container[0].scrollHeight;
      container.scrollTop(height);
    }
    });
      });
});
    ///end Rev3
  });
});


</script>


<script src='https://www.google.com/recaptcha/api.js?render=6LeZaXMhAAAAAIeQV_ILv_8HtCJO5MGOiyD9PxSP'></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>hljs.initHighlightingOnLoad();</script>



</body>
  </html>